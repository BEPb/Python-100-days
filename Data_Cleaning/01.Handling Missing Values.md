# Handling Missing Values
Очистка данных — ключевая часть науки о данных, но она может сильно разочаровывать. Почему некоторые текстовые поля 
искажены? Что делать с этими отсутствующими значениями? Почему ваши даты имеют неправильный формат? Как можно быстро 
очистить несогласованный ввод данных? В этом курсе вы узнаете, почему вы столкнулись с этими проблемами и, что более 
важно, как их исправить!    

В этом курсе вы узнаете, как решать некоторые из наиболее распространенных проблем очистки данных, чтобы вы могли 
быстрее анализировать свои данные. Вы выполните пять практических упражнений с реальными беспорядочными данными и 
ответите на некоторые из наиболее часто задаваемых вопросов по очистке данных.

В этой записной книжке мы рассмотрим, как работать с пропущенными значениями.

### Взгляните на данные
Первое, что нам нужно сделать, это загрузить библиотеки и набор данных, которые мы будем использовать.

Для демонстрации мы будем использовать набор данных о событиях, произошедших в играх по американскому футболу. В 
следующем упражнении вы примените свои новые навыки к набору данных о разрешениях на строительство, выданных в 
Сан-Франциско.   
```python
# modules we'll use
import pandas as pd
import numpy as np

# read in all our data
nfl_data = pd.read_csv("../input/nflplaybyplay2009to2016/NFL Play by Play 2009-2017 (v4).csv")

# set seed for reproducibility
np.random.seed(0) 
```

Первое, что нужно сделать, получив новый набор данных, — это взглянуть на некоторые из них. Это позволяет увидеть, 
что все считывается правильно, и дает представление о том, что происходит с данными. В этом случае давайте посмотрим,
есть ли пропущенные значения, которые будут представлены как NaN или None.  

```python
# look at the first five rows of the nfl_data file. 
# I can see a handful of missing data already!
nfl_data.head()
```
Да, похоже, что есть некоторые пропущенные значения.

### Сколько у нас недостающих точек данных?
Хорошо, теперь мы знаем, что у нас есть некоторые пропущенные значения. Давайте посмотрим, сколько у нас есть в 
каждом столбце. 
```python
# get the number of missing data points per column
missing_values_count = nfl_data.isnull().sum()

# look at the # of missing points in the first ten columns
missing_values_count[0:10]
```
Кажется, это много! Может быть полезно посмотреть, какой процент значений в нашем наборе данных отсутствовал, чтобы 
дать нам лучшее представление о масштабе этой проблемы: 

```python
# how many total missing values do we have?
total_cells = np.product(nfl_data.shape)
total_missing = missing_values_count.sum()

# percent of data that is missing
percent_missing = (total_missing/total_cells) * 100
print(percent_missing)
```

Ничего себе, почти четверть ячеек в этом наборе данных пусты! На следующем шаге мы более подробно рассмотрим 
некоторые столбцы с пропущенными значениями и попытаемся выяснить, что с ними происходит. 

### Выясните, почему данные отсутствуют
Это момент, когда мы подходим к той части науки о данных, которую я люблю называть «интуицией данных», под которой я 
подразумеваю «действительное рассмотрение ваших данных и попытку понять, почему они такие, какие они есть, и как это 
изменится». повлиять на ваш анализ». Это может быть разочаровывающей частью науки о данных, особенно если вы новичок 
в этой области и не имеете большого опыта. Для работы с отсутствующими значениями вам нужно использовать свою 
интуицию, чтобы выяснить, почему значение отсутствует. Один из самых важных вопросов, который вы можете задать себе, 
чтобы понять это, заключается в следующем:

Это значение отсутствует, потому что оно не было записано или потому что оно не существует?

Если значение отсутствует, потому что оно не существует (например, рост самого старшего ребенка того, у кого нет 
детей), то нет смысла пытаться угадать, что это может быть. Эти значения вы, вероятно, хотите сохранить как NaN. С 
другой стороны, если значение отсутствует, потому что оно не было записано, вы можете попытаться угадать, что это 
могло быть, основываясь на других значениях в этом столбце и строке. Это называется вменение, и мы узнаем, как это 
сделать дальше! :)

Давайте поработаем на примере. Глядя на количество пропущенных значений в кадре данных nfl_data, я замечаю, что в 
столбце «TimesSec» много пропущенных значений: 
```python
# look at the # of missing points in the first ten columns
missing_values_count[0:10]
```

Глядя на документацию, я вижу, что в этой колонке есть информация о количестве секунд, оставшихся в игре, когда игра 
была сделана. Это означает, что эти значения, вероятно, отсутствуют, потому что они не были записаны, а не потому, 
что они не существуют. Таким образом, для нас имеет смысл попытаться угадать, какими они должны быть, а не просто 
оставить их как АН.   

С другой стороны, есть и другие поля, такие как «PenalizedTeam», в которых также много отсутствующих полей. Однако в 
данном случае поле отсутствует, потому что если пенальти не было, то нет смысла говорить, какая команда была 
оштрафована. Для этого столбца имеет смысл либо оставить его пустым, либо добавить третье значение, например «ни 
один», и использовать его для замены NA.   

Совет: это отличное место, чтобы прочитать документацию по набору данных, если вы еще этого не сделали! Если вы 
работаете с набором данных, полученным от другого человека, вы также можете попробовать связаться с ним, чтобы 
получить дополнительную информацию.  

Если вы проводите очень тщательный анализ данных, это тот момент, когда вы просматриваете каждый столбец по 
отдельности, чтобы найти наилучшую стратегию для заполнения этих отсутствующих значений. В оставшейся части этой 
записной книжки мы рассмотрим некоторые «быстрые и грязные» методы, которые могут помочь вам с отсутствующими 
значениями, но, вероятно, также приведут к удалению некоторой полезной информации или добавлению некоторого шума к 
вашим данным.    

### Отбросить недостающие значения
Если вы спешите или у вас нет причин выяснять, почему ваши значения отсутствуют, у вас есть один вариант — просто 
удалить все строки или столбцы, содержащие отсутствующие значения. (Примечание: я обычно не рекомендую этот подход 
для важных проектов! Обычно стоит потратить время на просмотр ваших данных и просмотр всех столбцов с отсутствующими 
значениями один за другим, чтобы действительно узнать ваш набор данных. .)   

Если вы уверены, что хотите удалить строки с отсутствующими значениями, в pandas есть удобная функция dropna(), 
которая поможет вам в этом. Давайте попробуем это на нашем наборе данных NFL! 

```python
# remove all the rows that contain a missing value
nfl_data.dropna()
```
О боже, похоже, все наши данные были удалены! 😱 Это потому, что в каждой строке нашего набора данных было хотя бы 
одно пропущенное значение. Вместо этого нам может повезти, удалив все столбцы, в которых есть хотя бы одно 
пропущенное значение.  

```python
# remove all columns with at least one missing value
columns_with_na_dropped = nfl_data.dropna(axis=1)
columns_with_na_dropped.head()
```

```python
# just how much data did we lose?
print("Columns in original dataset: %d \n" % nfl_data.shape[1])
print("Columns with na's dropped: %d" % columns_with_na_dropped.shape[1])
```
Мы потеряли довольно много данных, но на данный момент мы успешно удалили все NaN из наших данных.

### Автоматическое заполнение пропущенных значений
Другой вариант — попытаться заполнить недостающие значения. Для этого следующего фрагмента я получаю небольшой 
подраздел данных НФЛ, чтобы он хорошо печатался. 

```python
# get a small subset of the NFL dataset
subset_nfl_data = nfl_data.loc[:, 'EPA':'Season'].head()
subset_nfl_data
```
Мы можем использовать функцию fillna() Panda, чтобы заполнить отсутствующие значения в кадре данных для нас. Один из 
вариантов, который у нас есть, — указать, чем мы хотим заменить значения NaN. Здесь я говорю, что хотел бы заменить 
все значения NaN на 0.

```python
# replace all NA's with 0
subset_nfl_data.fillna(0)
```
Я также мог бы быть немного более сообразительным и заменить отсутствующие значения любым значением, которое идет 
сразу после него в том же столбце. (Это имеет смысл для наборов данных, в которых наблюдения имеют какой-то 
логический порядок.)   

```python
# replace all NA's the value that comes directly after it in the same column, 
# then replace all the remaining na's with 0
subset_nfl_data.fillna(method='bfill', axis=0).fillna(0)
```

