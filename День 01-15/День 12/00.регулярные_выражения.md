## регулярные выражения

### Знания о регулярных выражениях

При написании программ или веб-страниц, обрабатывающих строки, часто возникает необходимость найти строки, которые соответствуют определенным сложным правилам. Регулярные выражения - это инструменты, используемые для описания этих правил. Другими словами, регулярные выражения - это инструмент. Определяет режим сопоставления строка (как проверить, соответствует ли строка определенному шаблону или извлечь или заменить часть, которая соответствует шаблону из строки). Если вы использовали поиск файлов в операционной системе Windows и использовали подстановочные знаки (* и?) При указании имен файлов, регулярные выражения также являются аналогичным инструментом для сопоставления текста, но по сравнению с регулярными выражениями с подстановочными знаками. более точно описать свои потребности (конечно, цена, которую вы платите, состоит в том, что написание регулярного выражения намного сложнее, чем ввод подстановочного знака. Вы должны знать, что все, что приносит вам пользу, имеет свою цену. Так же, как изучение языка программирования), например , вы можете написать регулярное выражение, чтобы найти все, начинающиеся с 0, за которыми следуют 2–3 числа, затем дефис «-» и, наконец, 7 или 8 цифр. Строка чисел (например, 028-12345678 или 0813-7654321), isn Разве это не городской городской номер? Вначале компьютеры были созданы для выполнения математических операций. Обработанная информация представляла собой в основном числовые значения. Сегодня информация, которую мы обрабатываем в нашей повседневной работе, представляет собой в основном текстовые данные. Мы надеемся, что компьютеры могут распознавать и обрабатывать текст, который соответствует определенным шаблонам., Регулярные выражения очень важны. Почти все языки программирования сегодня обеспечивают поддержку операций с регулярными выражениями.Пайтон поддерживает операции с регулярными выражениями через модуль re в стандартной библиотеке.

Мы можем рассмотреть следующий вопрос: мы откуда-то получили строку (например, текстовый файл или новость в Интернете) и надеемся найти в строке номер мобильного телефона и номер стационарного телефона. Конечно, мы можем установить номер мобильного телефона как 11-значное число (обратите внимание, что это не случайное 11-значное число, потому что вы никогда не видели номер мобильного телефона, такой как "25012345678"), и номер стационарного телефона будет таким же как и в случае с шаблоном, описанным в предыдущем абзаце, использование регулярных выражений для выполнения этой задачи будет очень проблематичным.

Что касается соответствующих знаний о регулярных выражениях, вы можете прочитать очень известный блог под названием «30-минутное руководство по регулярным выражениям » . Прочитав эту статью, вы сможете понять следующую таблицу. Это наше понимание регулярных выражений. Краткое изложение некоторых основные символы в.


| условное обозначение	| объяснять	| Пример	|                                              
| ------------------ | ----------------------------------------- | ---------------- | 
| .                  | Один любой символ, кроме новой строки \n.                              | b.t              | 
| \\w                | Соответствие букв / цифр / знаков подчеркивания                      | b\\wt            | 
| \\s                | Соответствовать пробельным символам (включая \ r, \ n, \ t и т. Д.)          | love\\syou       | 
| \\d                | Совпадение чисел                                  | \\d\\d           | 
| \\b                | Сопоставить границы слов                           | \\bThe\\b        | 
| ^                  | Соответствует началу строки                          | ^The             | 
| $                  | Соответствует конец строки                          | .exe$            | 
| \\W                 | Соответствие без букв / цифр / подчеркивания                    | b\\Wt            | 
| \\S                 | Соответствовать непробельным символам                            | love\\Syou       | 
| \\D                 | Совпадение без цифр                                | \\d\\D           | 
| \\B                 | Сопоставить границы без слов                            | \\Bio\\B         |  
| []                 | Соответствует любому одиночному символу из набора символов              | [aeiou]          | 
| [^]                | Соответствует любому одиночному символу, не входящему в набор символов            | [^aeiou]         | 
| *                  | Совпадение 0 или более раз                             | \\w*             | 
| +                  | Совпадение 1 или более раз                            | \\w+             |  
| ?                  | Совпадение 0 или 1 раз                             | \\w?             |    
| {N}                | Совпадение N раз                                   | \\w{3}            | 
| {M,}               | Матч не менее M раз                               | \\w{3,}           |  
| {M,N}              | Соответствовать не менее M раз и не более N раз                        | \\w{3,6}          |  
| \|                 | Ветвь                                     | foo\|bar         | 
| (?#)               | Аннотации                                   |                  |  
| (exp)              | Сопоставьте опыт и захват в автоматически названную группу             |                  |   
| (?&lt;name&gt;exp) | Сопоставьте exp и захватите группу с именем name             |                  | 
| (?:exp)            | Соответствует exp, но не захватывает совпадающий текст      |                  | 
| (?=exp)            | Соответствует позиции до exp                         | \\b\\w+(?=ing)     | 
| (?<=exp)           | Соответствует позиции за exp                         | (?<=\\bdanc)\\w+\\b | 
| (?!exp)            | Позиция без опыта после матча                     |                  | 
| (?<!exp)           | Сопоставьте позицию, которая не является экспозицией впереди                    |                  | 
| *?                 | Повторите столько раз, сколько возможно, но как можно реже | a.\*b<br>a.\*?b | 
| +?                 | Повторите 1 или более раз, но как можно реже. |                  |    
| ??                 | Повторите 0 или 1 раз, но повторяйте как можно реже. |                  |  
| {M,N}?             | Повторите от M до N раз, но повторяйте как можно реже. |                  |  
| {M,}?              | Повторите более M раз, но повторяйте как можно реже |                  |  

> Примечание. Если сопоставляемый символ является специальным символом в регулярном выражении, вы можете использовать \ для экранирования, например, если вы хотите сопоставить десятичную точку, вы можете написать \., Потому что запись напрямую. Будет соответствовать любому символу ; то же самое, подумайте, что соответствующие скобки должны быть записаны как \ (и \), в противном случае круглые скобки рассматриваются как группировки в регулярных выражениях.


### Поддержка регулярных выражений в Python

Python предоставляет модуль re для поддержки операций, связанных с регулярными выражениями. Ниже приведены основные функции модуля re.


| функция	| иллюстрировать                                                     |
| -------------------------------------------- | ------------------------------------------------------------ |
| compile(pattern, flags=0)                    | Скомпилируйте регулярное выражение и верните объект регулярного выражения                            |
| match(pattern, string, flags=0)              | Используйте регулярное выражение, чтобы успешно сопоставить строку и вернуть соответствующий объект, в противном случае оно вернет None         |
| search(pattern, string, flags=0)             | Первое вхождение шаблона регулярного выражения в строку поиска возвращает соответствующий объект успешно, в противном случае возвращается None. |
| split(pattern, string, maxsplit=0, flags=0)  | Разделите строку с помощью разделителя шаблонов, указанного в регулярном выражении, и верните список              |
| sub(pattern, repl, string, count=0, flags=0) | Замените шаблон, который соответствует регулярному выражению в исходной строке, на указанную строку. Вы можете использовать count, чтобы указать количество замен. |
| fullmatch(pattern, string, flags=0)          | Версия функции сопоставления с точным соответствием (от начала до конца строки)                |
| findall(pattern, string, flags=0)            | Найдите все шаблоны, которые соответствуют регулярному выражению в строке, и верните список строк        |
| finditer(pattern, string, flags=0)           | Найдите все шаблоны в строке, которые соответствуют регулярному выражению, и верните итератор          |
| purge()                                      | Очистить кеш от неявно скомпилированных регулярных выражений                               |
| re.I / re.IGNORECASE                         | Игнорировать токены соответствия регистра                                           |
| re.M / re.MULTILINE                          | Многострочный тег соответствия                                                 |

> Примечание. Эти функции в упомянутом выше модуле re также могут быть заменены объектами регулярных выражений в реальной разработке. Если регулярное выражение необходимо использовать повторно, сначала скомпилируйте регулярное выражение с помощью функции компиляции Formula и создайте объект регулярного выражения. более разумный выбор.

Ниже мы используем серию примеров, чтобы показать вам, как использовать регулярные выражения в Python.

#### Убедитесь, что введенное имя пользователя и номер QQ действительны, и дайте соответствующую подсказку.

```Python
"""
Python 3.9 Убедитесь, что введенное имя пользователя и номер QQ действительны, и дайте соответствующую подсказку.
Имя пользователя должно состоять из букв, цифр или знаков подчеркивания и иметь длину от 6 до 20 символов.
Номер QQ - это число от 5 до 12, и первая цифра не может быть 0.
Название файла '03.проверка_имени.py'

Version: 0.1
Author: Andrej Marinchenko
Date: 2021-11-11
"""

import re


def main():
    username = input('Пожалуйста, введите имя пользователя: ')
    qq = input('Пожалуйста, введите номер QQ: ')
    m1 = re.match(r'^[0-9a-zA-Z_]{6,20}$', username)
    if not m1:
        print('Пожалуйста, введите действительное имя пользователя.')
    m2 = re.match(r'^[1-9]\d{4,11}$', qq)
    if not m2:
        print('Пожалуйста, введите действительный номер QQ.')
    if m1 and m2:
        print('Введенная вами информация действительна!')


if __name__ == '__main__':
    main()
```

> Напоминание: запись «исходной строки» используется при написании регулярного выражения выше (r добавляется перед строкой). Так называемая «исходная строка» означает, что каждый символ в строке имеет свое исходное значение. Более конкретно, в строке нет так называемых escape-символов. Поскольку в регулярных выражениях есть много метасимволов и мест, которые необходимо экранировать, если вы не используете исходную строку, вам нужно записать обратную косую черту как \\. Например, \ d, представляющий число, должно быть записано как \\ d, чтобы не только написано. Это неудобно, но и трудночитаемо.

#### извлеките номер домашнего мобильного телефона из фрагмента текста.

```Python
"""
Python 3.9 регулярное выражение
Название файла '04.регулярное_выражение.py'

Version: 0.1
Author: Andrej Marinchenko
Date: 2021-11-11
"""
import re


def main():
    # Создайте объект регулярного выражения, используя упреждающий просмотр и проверку, чтобы убедиться, что перед и после номера мобильного телефона не должно быть чисел.
    pattern = re.compile(r'(?<=\D)(1[38]\d{9}|14[57]\d{8}|15[0-35-9]\d{8}|17[678]\d{8})(?=\D)')
    sentence = '''
    Важно то, что 8130123456789 раз мой мобильный номер 13512346789,
    Это не 15600998765, это 110 или 119, номер мобильного телефона Иван - 15600998765.
    '''
    # Найдите все совпадения и сохраните их в списке
    mylist = re.findall(pattern, sentence)
    print(mylist)
    print('--------Великолепный разделитель--------')
    # Используйте функцию поиска, чтобы указать место поиска, чтобы найти все совпадения
    for temp in pattern.finditer(sentence):
        print(temp.group())
    print('--------Великолепный разделитель--------')
    # Используйте функцию поиска, чтобы указать место поиска, чтобы найти все совпадения
    m = pattern.search(sentence)
    while m:
        print(m.group())
        m = pattern.search(sentence, m.end())


if __name__ == '__main__':
    main()
```

> Примечание. Вышеупомянутые регулярные выражения для сопоставления номеров домашних мобильных телефонов недостаточно хороши, потому что числа, начинающиеся с 14, равны только 145 или 147, а указанные выше регулярные выражения не учитывают это. Для сопоставления номеров домашних мобильных телефонов лучше регулярное выражение Формула: (?<=\D)(1[38]\d{9}|14[57]\d{8}|15[0-35-9]\d{8}|17[678]\d{8})(?=\D)кажется, что в последнее время в Китае появились номера мобильных телефонов, начинающиеся с 19 и 16, но пока это не рассматривается нами.

#### Заменить недопустимый контент в строке

```Python
"""
Python 3.9 Фильтрация нежелательного содержания
Название файла '05.фильтрация.py'

Version: 0.1
Author: Andrej Marinchenko
Date: 2021-11-11
"""
import re


def main():
    sentence = 'Ты глуп? Я трахнул твоего дядю. Пошел ты на хуй.'
    purified = re.sub('[иметь]|на хуй|дерьмо|глупо[тупо]|урод',
                      '*', sentence, flags=re.IGNORECASE)
    print(purified)


if __name__ == '__main__':
    main()
```

> Описание: В функциях модуля re, связанных с регулярным выражением, есть параметр flags, который представляет метку сопоставления регулярного выражения. Вы можете использовать эту метку, чтобы указать, следует ли игнорировать регистр при сопоставлении, выполнять ли сопоставление нескольких строк, и следует ли отображать отладочную информацию. Если вам нужно указать несколько значений для параметра flags, вы можете использовать побитовый оператор OR для наложения, например `flags=re.I | re.M.`

####  разделение длинной строки

```Python
import re


def main():
    poem = 'Луна светит перед окном, предположительно, изморозь на земле. Глядя вверх на яркую луну, глядя на родной город. '
    sentence_list = re.split(r'[，。, .]', poem)
    while '' in sentence_list:
        sentence_list.remove('')
    print(sentence_list) 


if __name__ == '__main__':
    main()
```

### Послесловие

Если вы хотите участвовать в разработке приложений для поисковых роботов, то регулярные выражения должны быть очень хорошим помощником, потому что они могут помочь нам быстро обнаружить определенный шаблон, который мы указываем в коде веб-страницы, и извлечь нужную нам информацию. Конечно, для Когда начинающие ученые соглашаются с этим, может быть нелегко написать правильное и подходящее регулярное выражение (конечно, некоторые часто используемые регулярные выражения можно найти прямо в Интернете), поэтому при реальной разработке приложения-краулера многие люди будут Выберите Beautiful Soup или Lxml для сопоставления и извлечения информации. Первый прост и удобен, но имеет низкую производительность, а второй прост в использовании и имеет хорошую производительность, но установка вызывает некоторые затруднения. Мы познакомим вас с этим содержимым в более поздняя тема поискового робота.
