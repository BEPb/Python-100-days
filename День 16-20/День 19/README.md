- Магические методы, связанные с итераторами и генераторами / два способа создания генераторов /

### Магические методы, связанные с итераторами и генераторами (день 19)

В Python итераторы (iterators) и генераторы (generators) используются для эффективного перебора последовательностей.

Итераторы представляют объекты, которые содержат последовательность элементов и поддерживают методы для 
последовательного доступа к этим элементам. Это крайне полезно для работы с большими массивами данных, где все 
данные не помещаются в оперативную память.  

Генераторы являются одним из самых мощных инструментов Python и могут использоваться для создания итераторов. Они 
позволяют создавать последовательности данных "на лету", не заполняя всю память компьютера. 

Вот несколько примеров магических методов, связанных с итераторами и генераторами Python:

- __iter__() - метод, который должен быть реализован в классе итераторов и должен возвращать сам объект итератора.
- __next__() - метод, который должен быть реализован в классе итераторов и должен возвращать следующий элемент 
  последовательности или вызывать исключение StopIteration, если элементов больше нет. 
- yield - ключевое слово, которое используется для создания генераторов. Оно позволяет создавать последовательности 
  данных на лету, возвращая каждый элемент последовательности в момент вызова yield. 

Итераторы - это объекты, которые возвращают последовательность элементов и позволяют выполнять итерации (циклические 
проходы) по этим элементам. Для создания итератора в Python нужно объявить класс, который имеет методы iter() и next(). 
Примеры использования магических методов:

```python
class MyIterator:
    def __init__(self, start, end):
        self.start = start
        self.end = end

    def __iter__(self):
        return self

    def __next__(self):
        if self.start >= self.end:
            raise StopIteration
        else:
            self.start += 1
            return self.start - 1

numbers = MyIterator(0, 5)
for number in numbers:
    print(number)
    
# Output:
# 0
# 1
# 2
# 3
# 4
```


```python
def my_generator(start, end):
    current = start
    while current < end:
        yield current
        current += 1

numbers = my_generator(0, 5)
for number in numbers:
    print(number)

# Output:
# 0
# 1
# 2
# 3
# 4
```

В обоих случаях мы создаем последовательность чисел от 0 до 4, но с использованием итератора и генератора.

Следующий пример - это код Python определяет класс `Fib`, который является итератором. При инициализации класса 
передается число `num`, которое определяет, сколько элементов последовательности Фибоначчи должен произвести этот 
итератор. 

В конструкторе класса устанавливаются переменные `a` и `b` в 0 и 1 соответственно, а также устанавливается 
переменная `idx` в 0 для отслеживания количества полученных элементов последовательности. 

Метод `__iter__` возвращает сам объект `self`, поэтому этот класс является итерируемым.

Метод `__next__` производит вычисление следующего числа последовательности Фибоначчи и возвращает его. Он также 
увеличивает переменную `idx` на 1 и продолжает вычисление, пока не будет получено `num` элементов последовательности.
Если `num` элементов уже получено, то метод генерирует исключение `StopIteration`, чтобы сообщить, что итерация 
завершена.   


```Python
class Fib(object):
    """Итератор"""
    
    def __init__(self, num):
        self.num = num
        self.a, self.b = 0, 1
        self.idx = 0
   
    def __iter__(self):
        return self

    def __next__(self):
        if self.idx < self.num:
            self.a, self.b = self.b, self.a + self.b
            self.idx += 1
            return self.a
        raise StopIteration()
```

- генератор — это итератор упрощенной версии синтаксиса.

```Python
def fib(num):
    """Фибоначчи"""
    a, b = 0, 1
    for _ in range(num):
        a, b = b, a + b
        yield a
```

### Два способа создания генераторов

1. Использование функции-генератора:

Функция-генератор - это функция, которая использует оператор yield для возврата значения и приостановления 
выполнения своей работы до следующего вызова. 

Пример:

```python
def my_generator():
    yield 'Hello'
    yield 'world'
    yield '!'
    
gen = my_generator()

print(next(gen)) # выводит 'Hello'
print(next(gen)) # выводит 'world'
print(next(gen)) # выводит '!'
```

2. Использование выражения-генератора:

Выражение-генератор - это компактный способ создания генераторов в одной строке кода. Он использует синтаксис 
генератора списков, но вместо списка возвращает генератор. 

Пример:

```python
my_generator = (x**2 for x in range(5))

for num in my_generator:
    print(num) # выводит квадраты чисел от 0 до 4
```

Обратите внимание, что можно использовать любые выражения вместо x**2 в данном примере. За счет этого вы можете 
генерировать любые значения в вашем генераторе. 

Примеры:
  - example01.py
  - example02.py

[Вернуться на главную](https://github.com/BEPb/Python-100-days)

[К следующему занятию](https://github.com/BEPb/Python-100-days/blob/master/%D0%94%D0%B5%D0%BD%D1%8C%2016-20/%D0%94%D0%B5%D0%BD%D1%8C%2020/README.md)
