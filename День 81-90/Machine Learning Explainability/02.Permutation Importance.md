# Permutation Importance
### Введение
Один из самых основных вопросов, которые мы можем задать модели: какие функции оказывают наибольшее влияние на прогнозы?

### Эта концепция называется важностью признаков.

Существует несколько способов измерения важности функции. Некоторые подходы отвечают на несколько разные версии 
поставленного выше вопроса. Другие подходы имеют задокументированные недостатки. 

В этом уроке мы сосредоточимся на важности перестановок. По сравнению с большинством других подходов важность перестановки:

- быстро считать,
- широко используется и понимается, и
- в соответствии со свойствами, которые мы хотели бы иметь для меры важности функции.

### Как это работает
Важность перестановки использует модели не так, как все, что вы видели до сих пор, и многие люди сначала находят это 
запутанным. Итак, мы начнем с примера, чтобы сделать его более конкретным. 

Рассмотрим данные в следующем формате:
Мы хотим предсказать рост человека, когда ему исполнится 20 лет, используя данные, доступные в возрасте 10 лет.

Наши данные включают в себя полезные признаки (рост в возрасте 10 лет), признаки с небольшой предсказательной силой 
(владение носками), а также некоторые другие признаки, на которых мы не будем акцентировать внимание в этом 
объяснении.  

Важность перестановки рассчитывается после подбора модели. Таким образом, мы не будем менять модель или прогнозы, 
которые мы получим для заданного значения роста, количества носков и т. д. 

Случайное изменение порядка одного столбца должно привести к менее точным прогнозам, поскольку полученные данные 
больше не соответствуют ничему, наблюдаемому в реальном мире. Точность модели особенно страдает, если мы 
перемешиваем столбец, на который модель сильно опиралась при прогнозировании. В этом случае перетасовка роста в 10 
лет вызовет ужасные предсказания. Если бы вместо этого мы перетасовали носки, полученные в результате, прогнозы не 
пострадали бы так сильно.

С этим пониманием процесс выглядит следующим образом:

### Получите обученную модель.
Перемешайте значения в одном столбце, сделайте прогнозы, используя полученный набор данных. Используйте эти прогнозы 
и истинные целевые значения, чтобы вычислить, насколько функция потерь пострадала от перетасовки. Это ухудшение 
производительности измеряет важность переменной, которую вы только что перетасовали.
Верните данные в исходный порядок (отменив перетасовку с шага 2). Теперь повторите шаг 2 со следующим столбцом в 
наборе данных, пока не рассчитаете важность каждого столбца. 

Вместо этого мы зададим следующий вопрос: если я случайным образом перемешаю один столбец проверочных данных, 
оставив цель и все остальные столбцы на месте, как это повлияет на точность прогнозов в этих уже перемешанных данных? 

### Пример кода¶
В нашем примере будет использоваться модель, которая предсказывает, будет ли у футбольной команды 
победитель «Лучшего игрока игры» на основе статистики команды. Награда «Человек игры» вручается лучшему игроку в 
игре. В настоящее время мы не занимаемся построением модели, поэтому ячейка ниже загружает данные и строит 
элементарную модель.

```python
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier

data = pd.read_csv('../input/fifa-2018-match-statistics/FIFA 2018 Statistics.csv')
y = (data['Man of the Match'] == "Yes")  # Convert from string "Yes"/"No" to binary
feature_names = [i for i in data.columns if data[i].dtype in [np.int64]]
X = data[feature_names]
train_X, val_X, train_y, val_y = train_test_split(X, y, random_state=1)
my_model = RandomForestClassifier(n_estimators=100,
                                  random_state=0).fit(train_X, train_y)
```

Вот как рассчитать и показать важность с помощью библиотеки eli5:
```python
import eli5
from eli5.sklearn import PermutationImportance

perm = PermutationImportance(my_model, random_state=1).fit(val_X, val_y)
eli5.show_weights(perm, feature_names = val_X.columns.tolist())
```

### Интерпретация важности перестановки
Значения вверху являются наиболее важными характеристиками, а значения внизу имеют наименьшее значение.

Первое число в каждой строке показывает, насколько снизилась производительность модели при случайном перемешивании 
(в данном случае с использованием «точности» в качестве показателя производительности).  

Как и большинство вещей в науке о данных, существует некоторая случайность в точном изменении производительности при 
перетасовке столбца. Мы измеряем степень случайности в нашем расчете важности перестановки, повторяя процесс с 
несколькими перетасовками. Число после ± показывает, как производительность менялась от одной перетасовки к другой.  

Иногда вы будете видеть отрицательные значения важности перестановок. В этих случаях предсказания перетасованных 
(или зашумленных) данных оказывались более точными, чем реальные данные. Это происходит, когда функция не имеет 
значения (должна иметь важность, близкую к 0), но случайность делает прогнозы на перетасованных данных более точными.
Это чаще встречается с небольшими наборами данных, такими как в этом примере, потому что здесь больше места для 
удачи/случайности.    

В нашем примере самой важной характеристикой были забитые голы. Это кажется разумным. У футбольных болельщиков может 
быть некоторая интуиция относительно того, удивительны ли порядки других переменных или нет. 

